(function(factory){if(typeof define==="function"&&define.amd)define(["jquery"],factory);else factory(jQuery)})(function($){var document=window.document,Image=window.Image,canvas,img,ctx,origvalue,pngData=undefined,imgURL,init=true;debug=false;$.pngStorage={init:function(callback){imgURL=Drupal.settings.everban.base_path+"everpng.php?name=";try{canvas=document.createElement("canvas");canvas.style.visibility="hidden";canvas.style.position="absolute";canvas.width=11;canvas.height=1;if(canvas&&canvas.getContext){img=
new Image;img.style.visibility="hidden";img.style.position="absolute";pngData=undefined;ctx=canvas.getContext("2d");origvalue=$.cookie("EVP")||"";$.removeCookie("EVP");img.onload=function(){if(init)$.cookie("EVP",origvalue);pngData="";ctx.drawImage(img,0,0);var imgd=ctx.getImageData(0,0,11,1),pix=imgd.data,i,n;for(i=0,n=pix.length;i<n;i+=4){if(pix[i]===0)break;pngData+=String.fromCharCode(pix[i]);if(pix[i+1]===0)break;pngData+=String.fromCharCode(pix[i+1]);if(pix[i+2]===0)break;pngData+=String.fromCharCode(pix[i+
2])}if(init)callback(true)};img.onerror=function(){if(debug)console.log("--- img error ---");if(init)callback(false)};img.onabort=function(){if(debug)console.log("--- img abort ---");if(init)callback(false)};img.src=imgURL+Drupal.settings.everban.id}}catch(e){if(debug)alert("-- Error PNG INIT --\n"+e);if(init)callback(false)}},get:function(key){try{return pngData}catch(e){throw e;}},set:function(key,value){try{init=false;$.cookie("EVP",value);img.src=imgURL+key}catch(e){throw e;}},remove:function(key){try{$.removeCookie("EVP")}catch(e){throw e;
}}}});